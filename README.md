[![Open in Visual Studio Code](https://classroom.github.com/assets/open-in-vscode-2e0aaae1b6195c2367325f4f02e2d04e9abb55f0b24a779b69b11b9e10269abc.svg)](https://classroom.github.com/online_ide?assignment_repo_id=20115661&assignment_repo_type=AssignmentRepo)
# Task Manager с интеграцией Telegram

## Задание

Ваша задача как бэкенд-разработчика — реализовать систему управления задачами для учебных групп. 
Регистрация пользователей и авторизация происходит через Telegram-бота. Все уведомления о статусах задач отправляются в Telegram.

Проект должен быть реализован в виде REST API с использованием **FastAPI** и иметь продуманную архитектуру с разделением на сервисы.

---

## Основной функционал

### Пользователи
- Регистрация и вход — **только через Telegram**.  
  Пользователь впервые пишет боту → бот сохраняет `chat_id` и автоматически производит регистрацию.
- Типы пользователей:
  - **Студент** — может просматривать свои задачи, менять статус своих задач.
  - **Преподаватель** — может создавать задачи для студентов, редактировать и проверять их выполнение.
  - **Менеджер группы** — получает уведомления в Telegram при изменении статусов задач у студентов группы.
  - **Администратор** — полный доступ ко всем данным, управлению пользователями и группами.

### Группы
- Преподаватель или администратор может создавать группы студентов.
- У каждой группы есть **менеджер** (назначенный пользователь, который получает уведомления о прогрессе студентов).

### Задачи
- Создаются преподавателем или администратором.
- Задача содержит:
  - Заголовок  
  - Описание  
  - Статус: `новая`, `в работе`, `сдана`, `принята`  
  - Исполнитель (студент)  
  - Дедлайн  
- При изменении статуса задачи студентом → уведомление отправляется менеджеру группы в Telegram.

---

## Модели данных

### User
- `id`: int, PK  
- `telegram_id`: str, уникальный идентификатор из Telegram  
- `username`: str, ник из Telegram  
- `full_name`: str, имя пользователя  
- `role`: enum(`student`, `teacher`, `manager`, `admin`)  
- `created_at`: datetime
- `updated_at`: datetime  

### Group
- `id`: int, PK  
- `name`: str  
- `students`: связь many-to-many с `User`  
- `manager_id`: FK на `User` (менеджер группы)
- `created_at`: datetime
- `updated_at`: datetime  

### Task
- `id`: int, PK  
- `title`: str  
- `description`: text  
- `status`: enum(`новая`, `в работе`, `сдана`, `принята`)  
- `student_id`: FK на `User`  
- `group_id`: FK на `Group`  
- `deadline`: datetime  
- `created_at`: datetime  
- `updated_at`: datetime  

---

## Эндпоинты

### Пользователи
- `POST /auth/telegram/callback` — регистрация/логин через Telegram  
- `GET /users/me` — информация о текущем пользователе  
- `GET /users/{id}` — получить данные пользователя (только админ/преподаватель)  

### Группы
- `POST /groups/` — создать группу (админ/преподаватель)  
- `GET /groups/` — список групп  
- `GET /groups/{id}` — детали группы  
- `POST /groups/{id}/add_student` — добавить студента в группу  

### Задачи
- `POST /tasks/` — создать задачу (админ/преподаватель)  
- `GET /tasks/` — список задач (фильтрация по студенту, группе, статусу)  
- `GET /tasks/{id}` — детали задачи  
- `PATCH /tasks/{id}` — изменить задачу (преподаватель/админ/исполнитель для смены статуса)  

---

## Уведомления

- При создании задачи студенту отправляется уведомление в Telegram.  
- При изменении статуса задачи → менеджеру группы приходит уведомление.  
- Если студент не сдал задачу до дедлайна → напоминание студенту и уведомление преподавателю.  

---

## Тестирование

В проекте должны быть реализованы автоматические тесты с использованием `pytest` и `httpx`.  
Обязательные тесты:
1. Регистрация через Telegram (имитация запроса от Telegram API).  
2. Создание группы и добавление студента.  
3. Создание задачи преподавателем.  
4. Изменение статуса задачи студентом.  
5. Проверка, что уведомление уходит менеджеру (mock вызова Telegram API).  
6. Проверка прав доступа (например, студент не может создавать задачи).  

Тесты должны запускаться автоматически через `pytest` и интегрироваться в CI.  

---

## Логирование

- Все действия пользователей (создание задач, смена статусов, вход в систему) должны логироваться в формате JSON.  
- Логи пишутся в файл `logs/app.log`.  
- Ошибки уровня `ERROR` и выше — дублируются в консоль.  

Пример структуры лога:
```json
{
  "timestamp": "2025-08-20T12:00:00",
  "level": "INFO",
  "user_id": 42,
  "action": "task_status_changed",
  "task_id": 12,
  "old_status": "в работе",
  "new_status": "сдана"
}
```

---

## Автоматическая проверка

1. Настроить `pytest` для запуска тестов.  
2. Настроить GitHub Actions workflow:
   - Запуск линтера (`flake8` или `ruff`)  
   - Запуск тестов (`pytest`)  
